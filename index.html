<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Meme Maker â€” Offline, No API</title>
  <meta name="description" content="Create viral memes fully offline. Upload an image, add draggable text, and download a PNG. No server, no API keys." />
  <meta name="theme-color" content="#0b0f14" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'%3E%3Crect width='256' height='256' rx='56' fill='%2308f'/%3E%3Ctext x='50%25' y='58%25' dominant-baseline='middle' text-anchor='middle' font-size='140' font-family='Arial, Helvetica, sans-serif' fill='white'%3EðŸ˜Ž%3C/text%3E%3C/svg%3E">
  <style>
    /* ---------- RESET ---------- */
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; line-height:1.5}
    img,svg,video,canvas{display:block;max-width:100%}
    button,input,select{font:inherit}
    :root{
      --bg: #0b0f14;
      --panel: rgba(255,255,255,0.06);
      --border: rgba(255,255,255,0.12);
      --text: #e8eef6;
      --muted: #a0adbd;
      --primary: #1aa3ff;
      --primary-2: #6b8cff;
      --shadow: 0 10px 30px rgba(0,0,0,.4);
      --radius: 18px;
    }
    .light{
      --bg: #f6f8fb;
      --panel: rgba(10,20,40,0.06);
      --border: rgba(10,20,40,0.12);
      --text: #0b1320;
      --muted: #4e5b6b;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
    }

    /* ---------- BACKGROUND ---------- */
    .bg{
      position:fixed; inset:0; z-index:-1;
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(26,163,255,.25), transparent 60%),
        radial-gradient(1000px 700px at 110% 10%, rgba(107,140,255,.20), transparent 60%),
        radial-gradient(800px 600px at 50% 110%, rgba(26,163,255,.18), transparent 60%),
        linear-gradient(160deg, #070a0f, #0b0f14 40%, #0d1118);
    }
    .light .bg{
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(26,163,255,.22), transparent 60%),
        radial-gradient(1000px 700px at 110% 10%, rgba(107,140,255,.18), transparent 60%),
        linear-gradient(160deg, #ffffff, #f6f8fb 60%, #eef2f8);
    }

    /* ---------- LAYOUT ---------- */
    .shell{max-width:1200px; margin:32px auto; padding:16px}
    header{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; margin-bottom:16px;
    }
    .brand{display:flex; align-items:center; gap:12px}
    .logo{
      width:42px;height:42px; border-radius:12px;
      background: linear-gradient(135deg, var(--primary), var(--primary-2));
      display:grid;place-items:center; color:white; font-weight:700;
      box-shadow: var(--shadow);
    }
    .title{display:flex; flex-direction:column}
    .title h1{margin:0; font-size:1.25rem; color:var(--text); letter-spacing:.2px}
    .title p{margin:0; color:var(--muted); font-size:.9rem}

    .toggle{
      display:inline-flex; align-items:center; gap:8px; padding:8px 12px;
      border-radius:999px; background:var(--panel); color:var(--text);
      border:1px solid var(--border); cursor:pointer; user-select:none;
      transition:transform .15s ease;
    }
    .toggle:active{transform:translateY(1px)}

    .grid{
      display:grid; gap:16px;
      grid-template-columns: 1.15fr .85fr;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns: 1fr}
    }

    /* ---------- CARDS ---------- */
    .card{
      background:var(--panel); border:1px solid var(--border);
      border-radius: var(--radius); padding:16px; backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      animation: pop .25s ease;
    }
    @keyframes pop { from{transform:scale(.98); opacity:.0} to{transform:scale(1); opacity:1} }

    /* ---------- CANVAS PANEL ---------- */
    .canvasWrap{
      aspect-ratio:1/1; background: #000; border-radius: 16px; overflow: hidden;
      display:grid; place-items:center; border:1px solid #111a22;
    }
    canvas{ max-width:100%; height:auto; background:#000 }
    .toolbar{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .btn{
      cursor:pointer; border:none; color:#fff; font-weight:700;
      padding:.8rem 1rem; border-radius:12px;
      background: linear-gradient(45deg, var(--primary), var(--primary-2));
      transition: filter .2s ease, transform .1s ease;
    }
    .btn:hover{filter:brightness(1.05)}
    .btn:active{transform:translateY(1px)}
    .btn.ghost{background:transparent; color:var(--text); border:1px solid var(--border)}

    /* ---------- CONTROLS PANEL ---------- */
    label{display:block; margin:.7rem 0 .35rem; color:var(--text); font-weight:600}
    .hint{color:var(--muted); font-size:.9rem}
    input[type="text"], input[type="number"], select, input[type="file"]{
      width:100%; padding:.7rem .9rem; border-radius:12px;
      background: transparent; color: var(--text);
      border:1px solid var(--border); outline:none;
    }
    .row{display:grid; grid-template-columns: 1fr 1fr; gap:12px}
    .badge{
      display:inline-flex; align-items:center; gap:6px;
      padding:.35rem .6rem; font-size:.8rem; color:var(--muted);
      background:var(--panel); border:1px solid var(--border); border-radius:999px;
    }
    .footer{
      text-align:center; color:var(--muted); font-size:.9rem; margin-top:10px;
    }
    .kbd{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; font-size:.85rem}
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>

  <div class="shell" id="app">
    <header>
      <div class="brand">
        <div class="logo">MM</div>
        <div class="title">
          <h1>Meme Maker</h1>
          <p>Fully offline â€¢ Drag text â€¢ Export PNG</p>
        </div>
      </div>
      <button class="toggle" id="themeToggle" title="Toggle theme">
        <span>Toggle theme</span> <span aria-hidden="true">ðŸŒ—</span>
      </button>
    </header>

    <div class="grid">
      <section class="card">
        <div class="canvasWrap">
          <canvas id="c" width="1024" height="1024" aria-label="Meme canvas"></canvas>
        </div>
        <div class="toolbar">
          <button class="btn" id="download">Download PNG</button>
          <button class="btn ghost" id="reset" title="Clear everything">Reset</button>
          <span class="badge">Tip: drag text on the canvas</span>
          <span class="badge">Hold <span class="kbd">Shift</span> while dragging for straight axis</span>
        </div>
      </section>

      <aside class="card">
        <label>Upload Image</label>
        <input type="file" id="file" accept="image/*">

        <label>Top Text</label>
        <input type="text" id="topText" placeholder="TOP TEXT">

        <label>Bottom Text</label>
        <input type="text" id="bottomText" placeholder="bottom text">

        <div class="row">
          <div>
            <label>Font</label>
            <select id="font">
              <option>Impact</option>
              <option>Arial Black</option>
              <option>Anton</option>
              <option>Montserrat ExtraBold</option>
            </select>
          </div>
          <div>
            <label>Font Size</label>
            <input type="number" id="fontSize" min="16" max="200" value="64">
          </div>
        </div>

        <div class="row">
          <div>
            <label>Stroke (Outline)</label>
            <input type="number" id="stroke" min="0" max="18" value="6">
          </div>
          <div>
            <label>Padding (%)</label>
            <input type="number" id="pad" min="0" max="15" value="4">
          </div>
        </div>

        <div class="row">
          <div>
            <label>All Caps</label>
            <select id="caps">
              <option value="1" selected>ON</option>
              <option value="0">OFF</option>
            </select>
          </div>
          <div>
            <label>Text Align</label>
            <select id="align">
              <option value="center" selected>Center</option>
              <option value="left">Left</option>
              <option value="right">Right</option>
            </select>
          </div>
        </div>

        <p class="hint">Private by design: everything runs in your browser. No upload. No API.</p>
      </aside>
    </div>

    <p class="footer">Built with vanilla HTML/CSS/JS â€¢ Works offline â€¢ Share if you like it ðŸš€</p>
  </div>

<script>
(() => {
  // -------- Theme toggle (persists) --------
  const root = document.documentElement;
  const savedTheme = localStorage.getItem('theme');
  if(savedTheme === 'light'){ root.classList.add('light'); }
  document.getElementById('themeToggle').addEventListener('click', () => {
    root.classList.toggle('light');
    localStorage.setItem('theme', root.classList.contains('light') ? 'light' : 'dark');
  });

  // -------- Canvas + Meme logic --------
  const CANVAS_SIZE = 1024;
  const c = document.getElementById('c');
  const ctx = c.getContext('2d', { alpha: false });
  const ui = {
    file: document.getElementById('file'),
    topText: document.getElementById('topText'),
    bottomText: document.getElementById('bottomText'),
    font: document.getElementById('font'),
    fontSize: document.getElementById('fontSize'),
    stroke: document.getElementById('stroke'),
    pad: document.getElementById('pad'),
    caps: document.getElementById('caps'),
    align: document.getElementById('align'),
    download: document.getElementById('download'),
    reset: document.getElementById('reset'),
  };

  let img = new Image();
  let bg = null; // offscreen canvas with fitted image

  const items = [
    { key:'top', text:'', x: CANVAS_SIZE/2, y: 120 },
    { key:'bottom', text:'', x: CANVAS_SIZE/2, y: CANVAS_SIZE - 100 },
  ];

  function draw(){
    // background
    ctx.fillStyle = '#000';
    ctx.fillRect(0,0, c.width, c.height);
    if (bg) ctx.drawImage(bg, 0,0);

    // text
    const size = +ui.fontSize.value;
    const padPct = (+ui.pad.value/100) * c.width;
    const stroke = +ui.stroke.value;
    const align = ui.align.value;
    ctx.textBaseline = 'middle';
    ctx.lineJoin = 'round';

    for (const it of items) {
      const raw = it.text || '';
      const str = (ui.caps.value === '1' ? raw.toUpperCase() : raw);
      const lines = wrapText(str, size, c.width - padPct*2, ui.font.value);
      lines.forEach((line, i) => {
        ctx.textAlign = align;
        const x = align === 'left' ? padPct : align === 'right' ? c.width - padPct : it.x;
        const y = it.y + i*(size + 6);
        ctx.font = `bold ${size}px "${ui.font.value}", Impact, Arial Black, system-ui, sans-serif`;
        if (stroke > 0) {
          ctx.lineWidth = Math.max(1, stroke);
          ctx.strokeStyle = '#000';
          ctx.strokeText(line, x, y);
        }
        ctx.fillStyle = '#fff';
        ctx.fillText(line, x, y);
      });
    }
  }

  function wrapText(text, size, maxWidth, font){
    if (!text) return [];
    ctx.font = `bold ${size}px "${font}", Impact, Arial Black, system-ui, sans-serif`;
    const words = text.split(' ');
    const lines = [];
    let line = '';
    for (const w of words) {
      const test = line ? line + ' ' + w : w;
      if (ctx.measureText(test).width > maxWidth && line) {
        lines.push(line);
        line = w;
      } else {
        line = test;
      }
    }
    if (line) lines.push(line);
    return lines;
  }

  function fileToCanvas(file, cb){
    const reader = new FileReader();
    reader.onload = e => {
      img.onload = () => {
        const off = document.createElement('canvas');
        off.width = CANVAS_SIZE; off.height = CANVAS_SIZE;
        const octx = off.getContext('2d', { alpha: false });
        octx.fillStyle = '#000'; octx.fillRect(0,0,off.width,off.height);
        const r = Math.max(CANVAS_SIZE/img.width, CANVAS_SIZE/img.height);
        const nw = img.width * r, nh = img.height * r;
        const dx = (CANVAS_SIZE - nw)/2, dy = (CANVAS_SIZE - nh)/2;
        octx.imageSmoothingEnabled = true;
        octx.imageSmoothingQuality = 'high';
        octx.drawImage(img, dx, dy, nw, nh);
        bg = off;
        draw();
        cb && cb();
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  }

  // --- events
  ui.file.addEventListener('change', () => {
    const f = ui.file.files && ui.file.files[0];
    if (f) fileToCanvas(f);
  });
  ui.topText.addEventListener('input', () => { items[0].text = ui.topText.value; draw(); });
  ui.bottomText.addEventListener('input', () => { items[1].text = ui.bottomText.value; draw(); });
  ['font','fontSize','stroke','pad','caps','align'].forEach(id => ui[id].addEventListener('input', draw));

  ui.download.addEventListener('click', () => {
    const a = document.createElement('a');
    a.download = 'meme.png';
    a.href = c.toDataURL('image/png');
    a.click();
  });

  ui.reset.addEventListener('click', () => {
    ui.file.value = '';
    ui.topText.value = '';
    ui.bottomText.value = '';
    items[0].text = items[1].text = '';
    bg = null;
    draw();
  });

  // --- drag to move text
  let dragIdx = -1;
  let start = null;
  c.addEventListener('pointerdown', (e) => {
    const pos = getPos(e);
    dragIdx = hitIndex(pos);
    if (dragIdx >= 0) start = pos;
  });
  c.addEventListener('pointermove', (e) => {
    if (dragIdx < 0) return;
    const pos = getPos(e);
    if (e.shiftKey){
      // lock axis with shift: choose stronger delta
      const dx = pos.x - start.x;
      const dy = pos.y - start.y;
      if (Math.abs(dx) > Math.abs(dy)) { pos.y = items[dragIdx].y; } else { pos.x = items[dragIdx].x; }
    }
    items[dragIdx].x = pos.x; items[dragIdx].y = pos.y;
    draw();
  });
  c.addEventListener('pointerup', () => { dragIdx = -1; start = null; });
  c.addEventListener('pointerleave', () => { dragIdx = -1; start = null; });

  function hitIndex(pos){
    // simple radial hit area
    const r = 80;
    for (let i=0;i<items.length;i++){
      if (Math.hypot(pos.x - items[i].x, pos.y - items[i].y) < r) return i;
    }
    return -1;
  }
  function getPos(e){
    const r = c.getBoundingClientRect();
    return {
      x: (e.clientX - r.left) * (c.width / r.width),
      y: (e.clientY - r.top) * (c.height / r.height),
    };
  }

  // initial paint
  draw();
})();
</script>
</body>
</html>
