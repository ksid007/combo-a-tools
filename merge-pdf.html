<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Merge PDF Files</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .drop-zone {
      border: 2px dashed #aaa;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      margin-bottom: 20px;
      transition: 0.3s ease;
    }
    .drop-zone.dragover {
      background-color: rgba(0, 0, 0, 0.05);
    }
    .file-preview {
      margin: 5px 0;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìö Merge PDF Files</h1>

    <div class="drop-zone" id="dropZone">
      Drag & Drop 2‚Äì5 PDF files here<br>or click to select
      <input type="file" accept="application/pdf" multiple id="pdfInput" style="display: none;" />
    </div>

    <div id="fileList"></div>
    <button onclick="mergePDFs()">Merge PDFs</button>
    <a id="downloadLink" style="display:none; margin-top: 15px;" download="merged.pdf">üì• Download Merged PDF</a>

    <a href="index.html">‚Üê Back to Home</a>
    <div class="toggle" onclick="toggleTheme()">üåì Toggle Dark Mode</div>
  </div>

  <!-- PDFLib -->
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script>
    const dropZone = document.getElementById("dropZone");
    const fileInput = document.getElementById("pdfInput");
    const fileList = document.getElementById("fileList");

    let pdfFiles = [];

    dropZone.addEventListener("click", () => fileInput.click());
    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.classList.add("dragover");
    });
    dropZone.addEventListener("dragleave", () => {
      dropZone.classList.remove("dragover");
    });
    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.classList.remove("dragover");
      handleFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener("change", () => handleFiles(fileInput.files));

    function handleFiles(files) {
      pdfFiles = [];
      fileList.innerHTML = "";

      const list = [...files].filter(f => f.type === "application/pdf");
      if (list.length < 2 || list.length > 5) {
        alert("Please select 2 to 5 PDF files.");
        return;
      }

      list.forEach(file => {
        pdfFiles.push(file);
        const div = document.createElement("div");
        div.className = "file-preview";
        div.textContent = "üìÑ " + file.name;
        fileList.appendChild(div);
      });
    }

    async function mergePDFs() {
      if (pdfFiles.length < 2) {
        alert("Please select at least 2 PDF files.");
        return;
      }

      const mergedPdf = await PDFLib.PDFDocument.create();

      for (const file of pdfFiles) {
        const bytes = await file.arrayBuffer();
        const pdf = await PDFLib.PDFDocument.load(bytes);
        const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
        copiedPages.forEach(page => mergedPdf.addPage(page));
      }

      const mergedBytes = await mergedPdf.save();
      const blob = new Blob([mergedBytes], { type: "application/pdf" });
      const url = URL.createObjectURL(blob);

      const link = document.getElementById("downloadLink");
      link.href = url;
      link.style.display = "inline-block";
    }

    function toggleTheme() {
      const html = document.documentElement;
      const current = html.getAttribute("data-theme");
      const next = current === "dark" ? "light" : "dark";
      html.setAttribute("data-theme", next);
      localStorage.setItem("theme", next);
    }

    (function () {
      const saved = localStorage.getItem("theme") || "light";
      document.documentElement.setAttribute("data-theme", saved);
    })();
  </script>
</body>
</html>
