<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Batch JPG ‚áå PNG Converter</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .drop-zone {
      border: 2px dashed #999;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      margin-bottom: 20px;
      transition: all 0.3s;
    }
    .drop-zone.dragover {
      background-color: rgba(0, 0, 0, 0.05);
    }
    .preview-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    .preview-item {
      width: 100px;
      text-align: center;
      font-size: 12px;
    }
    .preview-item img {
      max-width: 100%;
      max-height: 80px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üñºÔ∏è JPG ‚áå PNG Batch Converter</h1>

    <div class="drop-zone" id="dropZone">
      <strong>Drag & Drop</strong> images here (1 to 5 files)<br />or click to select
      <input type="file" id="fileInput" accept="image/jpeg, image/png" multiple style="display: none;" />
    </div>

    <div class="preview-grid" id="previewGrid"></div>

    <select id="format">
      <option value="png">Convert to PNG</option>
      <option value="jpeg">Convert to JPG</option>
    </select>

    <button onclick="convertImages()">Convert All</button>
    <div id="downloads"></div>
    <a href="index.html">‚Üê Back to Home</a>
    <div class="toggle" onclick="toggleTheme()">üåì Toggle Dark Mode</div>
  </div>

  <script>
    const fileInput = document.getElementById("fileInput");
    const dropZone = document.getElementById("dropZone");
    const previewGrid = document.getElementById("previewGrid");
    const downloads = document.getElementById("downloads");

    let images = [];

    dropZone.addEventListener("click", () => fileInput.click());
    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.classList.add("dragover");
    });
    dropZone.addEventListener("dragleave", () => {
      dropZone.classList.remove("dragover");
    });
    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.classList.remove("dragover");
      handleFiles(e.dataTransfer.files);
    });

    fileInput.addEventListener("change", () => {
      handleFiles(fileInput.files);
    });

    function handleFiles(files) {
      images = [];
      previewGrid.innerHTML = "";
      downloads.innerHTML = "";

      if (files.length < 1 || files.length > 5) {
        alert(" Thanks For Using ");
        return;
      }

      [...files].forEach((file) => {
        if (!file.type.startsWith("image/")) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.src = e.target.result;
          img.onload = () => {
            // Resize preview image to 100px width
            const canvas = document.createElement("canvas");
            const scale = 100 / img.width;
            canvas.width = 100;
            canvas.height = img.height * scale;

            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

            const previewThumb = canvas.toDataURL("image/png");

            images.push({ file, src: e.target.result, width: img.width, height: img.height });

            const div = document.createElement("div");
            div.className = "preview-item";
            div.innerHTML = `<img src="${previewThumb}" alt="Preview" /><div>${file.name}</div>`;
            previewGrid.appendChild(div);
          };
        };
        reader.readAsDataURL(file);
      });
    }

    function convertImages() {
      const format = document.getElementById("format").value;
      if (images.length < 1) 
        return;
      

      downloads.innerHTML = "";

      images.forEach(({ src, width, height, file }) => {
        const canvas = document.createElement("canvas");
        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext("2d");

        const img = new Image();
        img.src = src;
        img.onload = () => {
          ctx.drawImage(img, 0, 0, width, height);
          canvas.toBlob((blob) => {
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = file.name.split(".")[0] + `-converted.${format}`;
            link.textContent = `üì• Download ${link.download}`;
            link.style.display = "block";
            link.style.margin = "5px 0";
            downloads.appendChild(link);
          }, `image/${format}`);
        };
      });
    }

    // Dark mode
    function toggleTheme() {
      const html = document.documentElement;
      const current = html.getAttribute("data-theme");
      const next = current === "dark" ? "light" : "dark";
      html.setAttribute("data-theme", next);
      localStorage.setItem("theme", next);
    }

    (function () {
      const saved = localStorage.getItem("theme") || "light";
      document.documentElement.setAttribute("data-theme", saved);
    })();
  </script>
</body>
</html>
