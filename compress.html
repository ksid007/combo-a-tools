<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image Size Compressor</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .drop-zone {
      border: 2px dashed #aaa;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      margin-bottom: 20px;
      transition: 0.3s ease;
    }
    .drop-zone.dragover {
      background-color: rgba(0, 0, 0, 0.05);
    }
    #preview {
      max-width: 100%;
      max-height: 200px;
      border-radius: 10px;
      display: block;
      margin: 10px auto;
    }
    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    .input-group input,
    .input-group select {
      flex: 1;
      padding: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üóúÔ∏è Image Compressor (by File Size)</h1>

    <div class="drop-zone" id="dropZone">
      <strong>Drag & Drop</strong> or click to upload JPG/PNG
      <input type="file" accept="image/*" id="fileInput" style="display: none;" />
    </div>

    <img id="preview" style="display: none;" />
    <div id="fileInfo" style="margin-bottom: 10px; color: gray;"></div>

    <div class="input-group">
      <input type="number" id="targetSize" placeholder="Enter target size" />
      <select id="unit">
        <option value="kb">KB</option>
        <option value="mb">MB</option>
      </select>
    </div>

    <button onclick="compress()">Compress</button>
    <a id="downloadLink" download="compressed.jpg" style="display:none; margin-top: 10px;">üì• Download Compressed Image</a>

    <a href="index.html">‚Üê Back to Home</a>
    <div class="toggle" onclick="toggleTheme()">üåì Toggle Dark Mode</div>
  </div>

  <script>
    const dropZone = document.getElementById("dropZone");
    const fileInput = document.getElementById("fileInput");
    const preview = document.getElementById("preview");
    const fileInfo = document.getElementById("fileInfo");

    let originalImage = null;

    dropZone.addEventListener("click", () => fileInput.click());
    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.classList.add("dragover");
    });
    dropZone.addEventListener("dragleave", () => {
      dropZone.classList.remove("dragover");
    });
    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.classList.remove("dragover");
      handleFile(e.dataTransfer.files[0]);
    });
    fileInput.addEventListener("change", () => handleFile(fileInput.files[0]));

    function handleFile(file) {
      if (!file || !file.type.startsWith("image/")) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        preview.src = e.target.result;
        preview.style.display = "block";
        fileInfo.textContent = `Original size: ${(file.size / 1024).toFixed(2)} KB`;
        originalImage = new Image();
        originalImage.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function compress() {
      if (!originalImage) {
        alert("Upload an image first.");
        return;
      }

      const sizeInput = parseFloat(document.getElementById("targetSize").value);
      const unit = document.getElementById("unit").value;
      if (!sizeInput || sizeInput <= 0) {
        alert("Enter a valid target size.");
        return;
      }

      const targetBytes = unit === "mb" ? sizeInput * 1024 * 1024 : sizeInput * 1024;

      const canvas = document.createElement("canvas");
      canvas.width = originalImage.width;
      canvas.height = originalImage.height;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(originalImage, 0, 0);

      let quality = 0.92;
      const step = 0.05;
      let currentBlob = null;

      function tryCompress() {
        canvas.toBlob((blob) => {
          if (!blob) return;
          if (blob.size <= targetBytes || quality <= 0.1) {
            const url = URL.createObjectURL(blob);
            const link = document.getElementById("downloadLink");
            link.href = url;
            link.style.display = "inline-block";
            link.textContent = `üì• Download (${(blob.size / 1024).toFixed(1)} KB)`;
          } else {
            quality -= step;
            tryCompress();
          }
        }, "image/jpeg", quality);
      }

      tryCompress();
    }

    function toggleTheme() {
      const html = document.documentElement;
      const current = html.getAttribute("data-theme");
      const next = current === "dark" ? "light" : "dark";
      html.setAttribute("data-theme", next);
      localStorage.setItem("theme", next);
    }

    (function () {
      const saved = localStorage.getItem("theme") || "light";
      document.documentElement.setAttribute("data-theme", saved);
    })();
  </script>
</body>
</html>
